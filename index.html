<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BAHUR TERMINAL</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap');

        :root {
            --bg: #000; --text: #fff; --border: rgba(255,255,255,0.1); --dim: #666; 
            --green: #00ff88; --red: #ff3b30; --accent: #fff;
        }

        body, html { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; }
        .noir-theme { --bg: #000; --text: #fff; --accent: #fff; }
        .light-theme { --bg: #f5f5f5; --text: #000; --border: rgba(0,0,0,0.1); --accent: #000; }

        .app-container { min-height: 100vh; background: var(--bg); transition: 0.3s; padding: 15px; box-sizing: border-box; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        /* Шапка */
        header { text-align: center; margin-bottom: 25px; border-bottom: 1px solid var(--border); padding-bottom: 15px; position: relative; }
        .logo { font-size: 28px; font-weight: 900; letter-spacing: 0.3em; margin: 0; }
        .theme-btn { position: absolute; top: 0; right: 0; background: none; border: 1px solid var(--border); color: var(--text); padding: 5px 12px; cursor: pointer; border-radius: 4px; }

        /* Статистика */
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .card { border: 1px solid var(--border); padding: 15px; background: rgba(128,128,128,0.05); }
        .card label { font-size: 8px; font-weight: 900; color: var(--dim); display: block; margin-bottom: 5px; }
        .card span { font-size: 20px; font-weight: 700; }

        /* Фильтры */
        .filters { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 10px; }
        .f-btn { background: none; border: 1px solid var(--border); color: var(--dim); padding: 6px 14px; font-size: 10px; font-weight: 700; cursor: pointer; white-space: nowrap; }
        .f-btn.active { border-color: var(--text); color: var(--text); background: rgba(255,255,255,0.1); }

        /* Поиск */
        .search-box { width: 100%; padding: 12px; background: rgba(128,128,128,0.1); border: 1px solid var(--border); color: var(--text); margin-bottom: 15px; box-sizing: border-box; border-radius: 4px; outline: none; }

        /* Список ароматов */
        .scent-list { display: flex; flex-direction: column; gap: 8px; }
        .scent-item { border: 1px solid var(--border); padding: 15px; display: grid; grid-template-columns: 40px 1fr auto; align-items: center; gap: 15px; cursor: pointer; transition: 0.2s; }
        .scent-item:hover { background: rgba(128,128,128,0.05); }
        .scent-id { color: var(--dim); font-size: 12px; }
        .scent-name { font-weight: 700; font-size: 15px; }
        .scent-brand { font-size: 9px; color: var(--dim); text-transform: uppercase; letter-spacing: 1px; }
        .prices { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }
        .p-row { font-size: 11px; }
        .p-row b { color: var(--green); font-size: 13px; margin-left: 5px; }

        /* Загрузка */
        .loader { text-align: center; padding: 50px; color: var(--dim); font-size: 12px; letter-spacing: 2px; }
    </style>
</head>
<body>

<div id="app">
    <div :class="['app-container', isDark ? 'noir-theme' : 'light-theme']">
        
        <header>
            <h1 class="logo">BAHUR</h1>
            <div class="mono" style="font-size: 10px; opacity: 0.5;">OFFICIAL TERMINAL</div>
            <button @click="isDark = !isDark" class="theme-btn">{{ isDark ? '☀' : '☾' }}</button>
        </header>

        <div v-if="loading" class="loader mono">ЗАГРУЗКА БАЗЫ ДАННЫХ...</div>

        <div v-else>
            <div class="stats">
                <div class="card"><label>ВСЕГО</label><span class="mono">{{ filtered.length }}</span></div>
                <div class="card"><label>СРЕДНЯЯ ЦЕНА (1КГ)</label><span class="mono">{{ avgPrice }}₽</span></div>
            </div>

            <input v-model="search" class="search-box mono" placeholder="ПОИСК АРОМАТА ИЛИ БРЕНДА...">

            <div class="filters">
                <button v-for="g in ['ВСЕ', 'm', 'w', 'y']" :key="g" @click="gender = g" :class="['f-btn', { active: gender === g }]">
                    {{ g === 'm' ? 'МУЖ' : g === 'w' ? 'ЖЕН' : g === 'y' ? 'УНИ' : 'ПОЛ' }}
                </button>
                <button v-for="q in ['ВСЕ', 'TOP', 'Q1', 'Q2']" :key="q" @click="quality = q" :class="['f-btn', { active: quality === q }]">
                    {{ q }}
                </button>
            </div>

            <div class="scent-list">
                <div v-for="p in filtered" :key="p.id" class="scent-item" @click="p.link ? window.open(p.link, '_blank') : null">
                    <div class="scent-id mono">{{ p.id }}</div>
                    <div>
                        <div class="scent-name">{{ p.name }}</div>
                        <div class="scent-brand">{{ p.brand }} | {{ p.factory }}</div>
                    </div>
                    <div class="prices mono">
                        <div class="p-row">50г <b>{{ p.p50 }}</b></div>
                        <div class="p-row">1кг <b>{{ p.p1000 }}</b></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue;

    createApp({
        setup() {
            const isDark = ref(true);
            const loading = ref(true);
            const products = ref([]);
            const search = ref('');
            const gender = ref('ВСЕ');
            const quality = ref('ВСЕ');

            const loadData = async () => {
                const url = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTtT4zLEY49maKt0VxanZWA2ORKO1h39Mc5wB-XcZclDTmWfroFxQNAPxomg3x0-w/pub?gid=1234145733&single=true&output=csv';
                try {
                    const res = await fetch(url);
                    const data = await res.text();
                    const rows = data.split(/\r?\n/).slice(1); // Пропускаем заголовок
                    
                    products.value = rows.map(row => {
                        const col = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.replace(/^"|"$/g, '').trim());
                        return {
                            id: col[0], link: col[1], brand: col[2], name: col[3],
                            gender: col[4], factory: col[5], quality: col[6],
                            p50: col[7], p500: col[8], p1000: col[9]
                        };
                    }).filter(p => p.id && !isNaN(p.id));
                } catch (e) {
                    console.error("Ошибка загрузки CSV:", e);
                } finally {
                    loading.value = false;
                }
            };

            const filtered = computed(() => {
                return products.value.filter(p => {
                    const s = search.value.toLowerCase();
                    return (p.name.toLowerCase().includes(s) || p.brand.toLowerCase().includes(s)) &&
                           (gender.value === 'ВСЕ' || p.gender === gender.value) &&
                           (quality.value === 'ВСЕ' || p.quality === quality.value);
                });
            });

            const avgPrice = computed(() => {
                const p = filtered.value;
                if (!p.length) return 0;
                const sum = p.reduce((acc, i) => acc + (parseInt(i.p1000) || 0), 0);
                return Math.round(sum / p.length);
            });

            onMounted(loadData);

            return { isDark, loading, search, gender, quality, filtered, avgPrice };
        }
    }).mount('#app');
</script>

</body>
</html>
